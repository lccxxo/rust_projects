通过bitcask引擎实现简单的KV键值对存储

bitcask是一个基于日志结构的键值对存储引擎，以简单、高性能和强一致性闻名

bitcask核心设计思想

1. 日志存储结构
   - 数据以追加方式写入磁盘，所有写操作，包括更新和删除都是顺序追加到当前活跃数据文件的末尾，不会原地修改旧数据。
   
   - 删除操作通过写入一个特殊的“墓碑标记”来标记键已删除
   
     ![ac560612c3394b3b68943591a8330d4e](./assets/ac560612c3394b3b68943591a8330d4e.jpg)
   
2. 内存索引
   - 所有键的元数据（键名、文件ID、大小等）都保存在内存的哈希表中，成为键目录（KeyDir）。
   
   - 读操作只需一次内存查找和一次磁盘读取
   
   - 索引格式：
   
     ![img](https://s2.51cto.com/oss/202201/04/60bb18374d6b8f6ebc320841b39f10fb.jpg)
   
3. 文件管理
   - 数据文件按照大小或者时间进行滚动（生成新文件），旧文件只读且不可修改。
   
   - 通过合并过程回收旧文件中的无效数据（被覆盖或删除的键），生成新的紧凑数据文件。
   
   - 文件格式：
   
     ![img](https://s5.51cto.com/oss/202201/04/d43a12a36bad0ad88fa3f130c2c9e199.jpg)



bitcask的工作流程

1. 写入
   - 将键值对追加到当前活跃数据文件
   - 更新内存中的KeyDir，指向最新的值位置
2. 读取
   - 在KeyDir查找键，获取文件ID和值的位置
   - 从对应的数据文件中读取值
3. 合并
   - 定期合并旧文件，去除重复和已删除的键，减少磁盘占用。

